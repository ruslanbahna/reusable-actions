# name: Print uncompressed container image size
# description: GitHub Container Regisrty does not support showing image size, will add them to the summary
# inputs:
#   built-image:
#     description: Path to an image that was built and loaded to Docke, including the label. Assumtion is that you have built and pulled the image.
#     required: true
#   base-image:
#     description: Path to an image that built-image is based off of, including the label, in order to make a comparison.
#     required: true
# runs: 
#   using: "composite"
#   steps:
#     - run: |
#         echo "### Container Image Sizes" >> $GITHUB_STEP_SUMMARY
#         echo "" >> $GITHUB_STEP_SUMMARY
#         docker pull ${{ inputs.base-image}}
#         image_size=$(docker inspect -f " {{ .Size }}" ${{ inputs.base-image }} | numfmt --to=si --suffix=B)
#         echo "Uncompressed container image size for base image ${{ inputs.base-image}} is $image-size." >> $GITHUB_STEP_SUMMARY
#         image_size=$(docker inspect -f "{{ .Size }}" ${{ inputs.built-image }} | numfmt --to=si --suffix=B)
#         echo "Uncompressed container image size for base image ${{ inputs.built-image}} is $image-size." >> $GITHUB_STEP_SUMMARY
#       shell: bash
name: Print uncompressed container image size
description: GitHub Container Registry does not support showing image size, will add them to the summary.

inputs:
  built-image:
    description: Path to an image that was built and loaded to Docker, including the label. Assumption is that you have built and pulled the image.
    required: true
  base-image:
    description: Path to an image that the built-image is based on, including the label, in order to make a comparison.
    required: true

runs: 
  using: "composite"
  steps:
    - run: |
        echo "### Container Image Sizes" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "ðŸ› ï¸ Pulling base image: ${{ inputs.base-image }}"
        if ! docker pull ${{ inputs.base-image }}; then
          echo "âŒ ERROR: Base image ${{ inputs.base-image }} could not be pulled." >> $GITHUB_STEP_SUMMARY
          exit 1
        fi

        echo "ðŸ› ï¸ Pulling built image: ${{ inputs.built-image }}"
        if ! docker pull ${{ inputs.built-image }}; then
          echo "âŒ ERROR: Built image ${{ inputs.built-image }} could not be pulled." >> $GITHUB_STEP_SUMMARY
          exit 1
        fi

        echo "âœ… Successfully pulled both images."

        base_size=$(docker inspect -f "{{ .Size }}" ${{ inputs.base-image }} | numfmt --to=si --suffix=B)
        built_size=$(docker inspect -f "{{ .Size }}" ${{ inputs.built-image }} | numfmt --to=si --suffix=B)

        echo "ðŸ“¦ Uncompressed container image size for base image ${{ inputs.base-image }}: $base_size." >> $GITHUB_STEP_SUMMARY
        echo "ðŸ“¦

